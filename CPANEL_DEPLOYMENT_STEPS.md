# خطوات نشر موقع Jaberco على cPanel

## الخطوات المطلوبة للنشر

### 1. إعداد قاعدة البيانات في cPanel

1. قم بتسجيل الدخول إلى لوحة تحكم cPanel الخاصة بك
2. ابحث عن قسم "Databases" ثم اختر "MySQL Databases" أو "PostgreSQL Databases"
3. قم بإنشاء قاعدة بيانات جديدة (على سبيل المثال: `jaberco_db`)
4. قم بإنشاء مستخدم جديد لقاعدة البيانات (على سبيل المثال: `jaberco_user`) واختر كلمة مرور قوية
5. امنح هذا المستخدم جميع الصلاحيات على قاعدة البيانات التي أنشأتها
6. احتفظ بمعلومات الاتصال بقاعدة البيانات (اسم قاعدة البيانات، اسم المستخدم، كلمة المرور، المضيف)

### 2. إعداد Node.js في cPanel

1. في لوحة تحكم cPanel، ابحث عن قسم "Software" ثم اختر "Setup Node.js App"
2. انقر على زر "Create Application"
3. حدد المسار حيث ترغب في تثبيت التطبيق (على سبيل المثال: `jaberco`)
4. اختر أحدث إصدار من Node.js (يفضل الإصدار 16.x أو أحدث)
5. في حقل "Application startup file"، أدخل `dist/index.js`
6. قم بتعيين متغيرات البيئة التالية:
   - `NODE_ENV`: production
   - `PORT`: (سيتم تعيينه تلقائياً بواسطة cPanel، اتركه فارغاً)
   - `DATABASE_URL`: (أدخل عنوان اتصال قاعدة البيانات التي أنشأتها)
   - `CLOUDINARY_CLOUD_NAME`: dsviwqpmy
   - `CLOUDINARY_API_KEY`: (أدخل مفتاح API الخاص بـ Cloudinary)
   - `CLOUDINARY_API_SECRET`: (أدخل سر API الخاص بـ Cloudinary)
   - `STRIPE_SECRET_KEY`: (أدخل المفتاح السري لـ Stripe)
   - `VITE_STRIPE_PUBLIC_KEY`: (أدخل المفتاح العام لـ Stripe)
   - `SENDGRID_API_KEY`: (أدخل مفتاح API الخاص بـ SendGrid)
   - `TWILIO_ACCOUNT_SID`: (أدخل SID الخاص بحساب Twilio)
   - `TWILIO_AUTH_TOKEN`: (أدخل رمز المصادقة الخاص بـ Twilio)
   - `TWILIO_PHONE_NUMBER`: (أدخل رقم هاتف Twilio)

7. انقر على "Create" لإنشاء تطبيق Node.js

### 3. رفع ملفات الموقع

1. قم بتنزيل الملفات التالية من مشروعك المحلي:
   - جميع الملفات والمجلدات الموجودة في المشروع باستثناء:
     - مجلد `node_modules`
     - مجلد `.git`
     - أي ملفات أخرى غير ضرورية للإنتاج

2. طريقة الرفع باستخدام مدير الملفات في cPanel:
   - انتقل إلى "File Manager" في cPanel
   - انتقل إلى المجلد الذي قمت بتحديده لتطبيق Node.js
   - انقر على "Upload" لرفع الملفات

3. طريقة الرفع باستخدام FTP:
   - استخدم أي برنامج FTP مثل FileZilla
   - اتصل بخادم FTP باستخدام بيانات الاعتماد التي حصلت عليها من cPanel
   - انتقل إلى المجلد الذي قمت بتحديده لتطبيق Node.js
   - ارفع الملفات

### 4. تثبيت التبعيات وإعداد قاعدة البيانات

1. افتح "Terminal" في cPanel أو استخدم SSH للاتصال بالخادم
2. انتقل إلى مجلد التطبيق:
   ```
   cd /path/to/your/app
   ```

3. قم بتثبيت التبعيات:
   ```
   npm install --production
   ```

4. قم بإنشاء هيكل قاعدة البيانات:
   ```
   node dist/drizzle/migrate.js
   ```

### 5. تشغيل التطبيق

1. في cPanel، عد إلى "Setup Node.js App"
2. حدد تطبيقك من القائمة
3. انقر على زر "Start App" لبدء تشغيل التطبيق

### 6. إعداد النطاق والـ htaccess

1. تأكد من أن ملف .htaccess موجود في المجلد الرئيسي للتطبيق، يحتوي على التوجيهات الصحيحة (كما هو موضح في ملف .htaccess المرفق)
2. في cPanel، انتقل إلى "Domains" أو "Subdomains" لإعداد النطاق الخاص بك للإشارة إلى مجلد التطبيق

### 7. التحقق من التثبيت

1. قم بزيارة موقعك من خلال النطاق الذي قمت بإعداده
2. تأكد من أن الصفحة الرئيسية تعمل بشكل صحيح
3. تحقق من وظائف الموقع المختلفة للتأكد من أنها تعمل كما هو متوقع

## استكشاف الأخطاء وإصلاحها

### مشكلة: التطبيق لا يبدأ
- تحقق من سجلات الخطأ في مجلد logs
- تأكد من أن متغيرات البيئة مضبوطة بشكل صحيح
- تأكد من أن ملف الإقلاع dist/index.js موجود وصالح

### مشكلة: خطأ في الاتصال بقاعدة البيانات
- تحقق من صحة بيانات الاتصال بقاعدة البيانات
- تأكد من أن المستخدم لديه صلاحيات كافية
- تحقق من إمكانية الوصول إلى قاعدة البيانات من التطبيق

### مشكلة: الصفحات لا تعمل أو تظهر أخطاء
- تحقق من ملف .htaccess وتأكد من أنه يقوم بتوجيه الطلبات بشكل صحيح
- تحقق من سجلات خطأ Apache/Nginx
- تأكد من أن ملفات الواجهة الأمامية تم بناؤها بشكل صحيح في مجلد dist/public

## الصيانة والتحديثات

1. لتحديث التطبيق، ارفع الملفات الجديدة واتبع الخطوات التالية:
   ```
   cd /path/to/your/app
   npm install --production
   pm2 restart jaberco
   ```

2. لإعادة تشغيل التطبيق:
   - في cPanel، انتقل إلى "Setup Node.js App"
   - حدد تطبيقك
   - انقر على "Restart App"

3. لإيقاف التطبيق:
   - في cPanel، انتقل إلى "Setup Node.js App"
   - حدد تطبيقك
   - انقر على "Stop App"

## الملفات المهمة للنشر

تأكد من وجود الملفات التالية في مجلد التطبيق بعد الرفع:

1. `package.json` - يحتوي على قائمة التبعيات
2. `dist/` - المجلد الذي يحتوي على الملفات المبنية
3. `.htaccess` - ملف توجيه الطلبات
4. `ecosystem.config.js` - ملف تكوين PM2
5. `drizzle/` - مجلد يحتوي على ملفات ترحيل قاعدة البيانات
6. `server-check.js` - سكربت للتحقق من حالة الخادم

## ملاحظات إضافية

- تأكد من ضبط أذونات الملفات بشكل صحيح (644 للملفات و755 للمجلدات)
- قم بإنشاء نسخة احتياطية لقاعدة البيانات بانتظام
- تحقق من سجلات الخطأ بانتظام للتأكد من عدم وجود مشاكل

إذا واجهت أي مشاكل أخرى، يرجى الاتصال بمزود الاستضافة أو مراجعة وثائق cPanel الرسمية.