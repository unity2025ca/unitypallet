<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Si el archivo solicitado existe, sírvelo directamente
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule ^ - [L]
  
  # Si la solicitud es para archivos estáticos, sírvelos desde dist/public
  RewriteRule ^(assets|images|css|js|fonts|favicon\.ico)(.*)$ dist/public/$1$2 [L]
  
  # Redirigir solicitudes de API a Node.js
  RewriteRule ^api(/.*)?$ http://localhost:3000/api$1 [P,L]
  
  # Para todo lo demás, servir index.html (para React Router)
  RewriteRule ^ dist/public/index.html [L]
</IfModule>

# Evitar acceso a archivos sensibles
<FilesMatch "^\.env|^\.git|ecosystem\.config\.js|package\.json|package-lock\.json|postcss\.config\.js|tailwind\.config\.js|tsconfig\.json|drizzle\.config\.ts">
  Order allow,deny
  Deny from all
</FilesMatch>

# Configuraciones adicionales
<IfModule mod_headers.c>
  # Configurar caché para archivos estáticos
  <FilesMatch "\.(jpg|jpeg|png|gif|ico|css|js)$">
    Header set Cache-Control "max-age=31536000, public"
  </FilesMatch>
  
  # Configurar CORS
  Header set Access-Control-Allow-Origin "*"
  Header set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
  Header set Access-Control-Allow-Headers "Content-Type, Authorization"
</IfModule>